<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Schema Doctor: Reducer Edition</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
</head>
<body class="theme-dark">
  <header class="topbar">
    <div class="brand">ü©∫ Schema Doctor: <span class="muted">Reducer Edition</span></div>
    <div class="actions">
      <button id="themeToggle" class="btn" title="Toggle theme">üåó Theme</button>
      <button id="copyBtn" class="btn" title="Copy reduced JSON">üìã Copy</button>
      <button id="downloadBtn" class="btn primary" title="Download reduced.json">‚¨áÔ∏è Download</button>
    </div>
  </header>

  <main class="layout">
    <section class="pane inputs">
      <h2>Input</h2>

      <div class="input-row">
        <label for="schemaUrl">Fetch by URL</label>
        <div class="urlbar">
          <input id="schemaUrl" type="url" placeholder="https://example.com/openapi.yaml or .json" />
          <button id="fetchBtn" class="btn">Fetch</button>
        </div>
      </div>

      <div class="input-row">
        <label>Upload file (JSON or YAML)</label>
        <div id="dropZone" class="dropzone" tabindex="0" aria-label="Drop file here or click to choose">
          <input id="fileInput" type="file" accept=".json,.yaml,.yml,application/json,text/yaml" hidden />
          <div class="dz-hint">Drag & drop here or <span class="linkish">browse</span></div>
        </div>
      </div>

      <div class="input-row">
        <label for="pasteArea">Paste JSON/YAML</label>
        <textarea id="pasteArea" placeholder="Paste your OpenAPI schema here‚Ä¶" rows="6"></textarea>
        <div class="row-right">
          <button id="loadPasteBtn" class="btn">Load Paste</button>
        </div>
      </div>

      <div class="input-row">
        <button id="reduceBtn" class="btn primary">Generate Reduced Schema</button>
        <span id="status" class="status" aria-live="polite"></span>
      </div>

      <!-- Optional Endpoint Filter (accordion, collapsed by default) -->
      <details id="filter-panel" class="filter-accordion">
        <summary class="filter-summary-row">
          <span class="chev" aria-hidden="true"></span>
          <span>Endpoint Filter</span>
          <small id="filter-summary" class="summary-pill"></small>
        </summary>
  
    <div class="filter-grid" style="display:grid; gap:.5rem; grid-template-columns: 1fr;">
        <div class="filter-toggle">
            <label class="switch">
              <input type="checkbox" id="filter-enabled" />
              <span class="slider" aria-hidden="true"></span>
              <span class="switch-label">Enable endpoint filtering</span>
            </label>
            <span class="toggle-hint">Only matching endpoints will be kept in the reduced schema.</span>
          </div>
  
      <div class="filter-row" style="display:flex; gap:1rem; flex-wrap:wrap;">
        <fieldset style="border:1px solid var(--border, rgba(255,255,255,.1)); border-radius:10px; padding:.5rem .75rem;">
          <legend>Methods</legend>
          <label><input type="checkbox" class="filter-method" value="get"    /> GET</label>
          <label><input type="checkbox" class="filter-method" value="post"   /> POST</label>
          <label><input type="checkbox" class="filter-method" value="put"    /> PUT</label>
          <label><input type="checkbox" class="filter-method" value="patch"  /> PATCH</label>
          <label><input type="checkbox" class="filter-method" value="delete" /> DELETE</label>
          <label><input type="checkbox" class="filter-method" value="head"   /> HEAD</label>
          <label><input type="checkbox" class="filter-method" value="options"/> OPTIONS</label>
          <label><input type="checkbox" class="filter-method" value="trace"  /> TRACE</label>
        </fieldset>
  
        <fieldset style="flex:1; min-width:280px; border:1px solid var(--border, rgba(255,255,255,.1)); border-radius:10px; padding:.5rem .75rem;">
          <legend>Path patterns (comma or newline)</legend>
          <textarea id="filter-paths" rows="3" placeholder="/zones, /dns_records or /accounts
  Use /regex/ to treat a token as RegExp"
            style="width:100%; resize:vertical;"></textarea>
        </fieldset>
      </div>
  
      <fieldset style="border:1px solid var(--border, rgba(255,255,255,.1)); border-radius:10px; padding:.5rem .75rem;">
        <legend>Tags / Categories</legend>
  
        <div id="filter-tags-toolbar" class="filter-toolbar">
            <input id="filter-tag-search" ...>
            <button id="tag-all" class="btn">All</button>
            <button id="tag-none" class="btn">None</button>
          </div>
          <div id="filter-tags" class="filter-tags">
          <em style="opacity:.7;">Open this panel after loading a schema to see tags‚Ä¶</em>
        </div>
      </fieldset>
  
      <div style="display:flex; gap:.5rem; align-items:center;">
        <button id="filter-clear" class="btn">Clear filter</button>
        <span id="filter-stats" style="opacity:.8;"></span>
      </div>
    </div>
  </details>
  
<!-- Persistent metrics -->
<div id="metrics" aria-live="polite">
    <span class="metric-label">Metrics</span>
    <span id="metric-lines"   class="metric-chip">Lines: ‚Äî</span>
    <span id="metric-actions" class="metric-chip">Actions: ‚Äî</span>
  </div>
      <details class="hint">
        <summary>Having CORS trouble fetching a URL?</summary>
        Try downloading the schema and using the upload/paste options. Some servers block cross‚Äëorigin fetches.
      </details>
    </section>

    <section class="pane editors">
      <div class="editor-group">
        <h2>Original (read‚Äëonly)</h2>
        <div id="originalEditor" class="editor"></div>
      </div>
      <div class="editor-group">
        <h2>Reduced (JSON)</h2>
        <div id="reducedEditor" class="editor"></div>
      </div>
    </section>
  </main>
  
  <footer class="foot">
    <small>Open‚Äësource libs: js‚Äëyaml, Ajv, Monaco, FileSaver</small>
  </footer>

  <!-- Libraries (CDNJS, no SRI to avoid mismatches) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ajv/8.17.1/ajv7.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" defer></script>

  <!-- Monaco loader -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs/loader.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.0/min/vs/loader.min.js" crossorigin="anonymous"></script>

  <script>
    // Monaco worker config for CDN usage
    window.MonacoEnvironment = {
      getWorkerUrl: function(workerId, label) {
        const base = 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/';
        const code = `self.MonacoEnvironment={baseUrl:'${base}'};importScripts('${base}vs/base/worker/workerMain.js');`;
        return URL.createObjectURL(new Blob([code], { type: 'text/javascript' }));
      }
    };
    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs' } });
  </script>

  <!-- App -->
  <script src="app.js"></script>
</body>
</html>
